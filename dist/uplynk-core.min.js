!function(){function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var d="function"==typeof require&&require;if(!s&&d)return d(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}return e}()({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e){e&&e.length>0&&(this._segments=e,this.numAds=e.length,this.startTime=e[0].startTime,this.endTime=e[e.length-1].endTime,this.duration=this.endTime-this.startTime)}return e.prototype.getAdPositionAt=function(e){for(var t=0;t<this._segments.length;t++)if(this._segments[t].startTime<=e&&e<=this._segments[t].endTime)return t+1;return 0},e.prototype.getSegmentAt=function(e){if(this._segments&&e>-1&&e<this._segments.length)return this._segments[e]},e.prototype.contains=function(e){return this.startTime<=e&&e<=this.endTime},e}();i.AdBreak=n},{}],2:[function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=e("./utils/observable"),o=e("./web-services/asset-info-service"),a=e("./web-services/ping-service"),s=e("./id3/id3-handler"),d=e("./utils/segment-map"),c=e("./utils/thumbnail-helper"),u=e("./events"),p=e("./utils/utils"),l=e("./license-manager"),h=e("./utils/utils"),f=function(e){function t(t,i){var n=e.call(this)||this;n._defaults={disableSeekDuringAdBreak:!0,showPoster:!1,debug:!1,limitResolutionToViewSize:!1};var r={};try{r=JSON.parse(t.getAttribute("data-config"))}catch(e){}return n._config=Object.assign({},n._defaults,i,r),n._video=t,n._id3Handler=new s.ID3Handler(t),n._id3Handler.on(s.ID3Handler.Event.ID3Tag,n._onID3Tag.bind(n)),n._id3Handler.on(s.ID3Handler.Event.TxxxID3Frame,n._onTxxxID3Frame.bind(n)),n._id3Handler.on(s.ID3Handler.Event.PrivID3Frame,n._onPrivID3Frame.bind(n)),n._id3Handler.on(s.ID3Handler.Event.TextID3Frame,n._onTextID3Frame.bind(n)),n._id3Handler.on(s.ID3Handler.Event.SliceEntered,n._onSliceEntered.bind(n)),n._onVideoTimeUpdate=n._onVideoTimeUpdate.bind(n),n._onVideoSeeking=n._onVideoSeeking.bind(n),n._onVideoSeeked=n._onVideoSeeked.bind(n),n._onMediaSourceOpen=n._onMediaSourceOpen.bind(n),n._onVideoPlaybackEnd=n._onVideoPlaybackEnd.bind(n),n._onTimerTick=n._onTimerTick.bind(n),n._isSafari=!1,n._isIE=!1,n._isFirefox=!1,n._isChrome=!1,n._firedReadyEvent=!1,n._ended=!1,n._usingCustomUI=!1,n._intervalId=0,n._licenseManager=null,n._overrideCurrentTime(),n._overrideEnded(),n}return n(t,e),t.prototype._overrideCurrentTime=function(){var e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");if(e){var t=e.get,i=e.set,n=this;Object.defineProperty(this._video,"currentTime",{get:function(){return t.apply(this)},set:function(e){if(n.canSeek()){n._ended=!1,e=parseFloat(e);var t=n.getSeekTime(e);i.apply(this,[t]),n._adaptiveSource.seek(t)}},enumerable:!1,configurable:!1})}},t.prototype._overrideEnded=function(){var e=this;Object.defineProperty(this._video,"ended",{get:function(){return e._ended},enumerable:!1,configurable:!1})},Object.defineProperty(t,"Event",{get:function(){return u.Events},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._stopMainLoop(),void 0!==this._adaptiveSource&&(this._adaptiveSource.delete(),this._adaptiveSource=void 0),this._objectUrl&&(window.URL.revokeObjectURL(this._objectUrl),this._objectUrl=null)},t.prototype.load=function(e){var t;t="string"==typeof e?e:e.url,this._protocol=h.getProtocol(t),h.isIE11OrEdge()&&"http:"===this._protocol&&this._isUplynkUrl(t)&&(this._protocol="https:",t="https:"+t.substr(5)),this._firedReadyEvent=!1,this._url=t,this._targetTime=void 0,this._forcedAdBreak=void 0,this._ended=!1,this._mediaSource=new MediaSource,void 0!==this._adaptiveSource&&(this._adaptiveSource.delete(),this._adaptiveSource=void 0),this._video.removeEventListener("timeupdate",this._onVideoTimeUpdate),this._video.removeEventListener("seeking",this._onVideoSeeking),this._video.removeEventListener("seeked",this._onVideoSeeked),this._video.removeEventListener("ended",this._onVideoPlaybackEnd),this._video.addEventListener("timeupdate",this._onVideoTimeUpdate),this._video.addEventListener("seeking",this._onVideoSeeking),this._video.addEventListener("seeked",this._onVideoSeeked),this._video.addEventListener("ended",this._onVideoPlaybackEnd),this._video.onloadedmetadata=this.updateVideoRect.bind(this),this._mediaSource.addEventListener("sourceopen",this._onMediaSourceOpen),this._adaptiveSource=new Module.AdaptiveSource,this._licenseManager=new l.LicenseManager(this._video,this._adaptiveSource),this._adaptiveSource.onBeamLoaded(this._onBeamLoaded.bind(this)),this._adaptiveSource.onTrackLoaded(this._onTrackLoaded.bind(this)),this._adaptiveSource.onLoaded(this._onSourceLoaded.bind(this)),this._adaptiveSource.onLoadError(this._onLoadError.bind(this)),this._adaptiveSource.onDrmError(this._onDrmError.bind(this)),this._adaptiveSource.onSegmentMapChanged(this._onSegmentMapChanged.bind(this)),this._adaptiveSource.startMainLoop(this._startMainLoop.bind(this)),this._adaptiveSource.stopMainLoop(this._stopMainLoop.bind(this)),this._adaptiveSource.startLicenseRequest(this._startLicenseRequest.bind(this)),this._adaptiveSource.onAudioTrackSwitched(this._onAudioTrackSwitched.bind(this)),p.isLocalStorageAvailable()&&this._adaptiveSource.setLoadAndSaveBandwidth(this._loadBandwidthHistory.bind(this),this._saveBandwidthHistory.bind(this)),this._objectUrl&&(window.URL.revokeObjectURL(this._objectUrl),this._objectUrl=null),this._objectUrl=window.URL.createObjectURL(this._mediaSource),this._video.src=this._objectUrl,this._video.load()},t.prototype.canSeek=function(){return void 0!==this._adaptiveSource&&("LIVE"===this.playlistType||"EVENT"===this.playlistType||(!this._usingCustomUI||(!this._config.disableSeekDuringAdBreak||void 0!==this._segmentMap&&!this._segmentMap.inAdBreak(this._video.currentTime))))},t.prototype.getSeekTime=function(e){if("LIVE"===this.playlistType||"EVENT"===this.playlistType)return e;if(!this._config.disableSeekDuringAdBreak)return e;if(!this._usingCustomUI)return e;var t=this._video.currentTime,i=this._segmentMap.getAdBreak(e);if(i)return i.startTime;var n=this._segmentMap.getAdBreaksBetween(t,e);return n&&n.length>0?(this._targetTime=e,this._forcedAdBreak=n[n.length-1],this._forcedAdBreak.startTime):e},t.prototype.setBrowser=function(e,t,i,n){this._isSafari=e,this._isIE=t,this._isFirefox=n,this._isChrome=i,this._usingCustomUI=!0},t.prototype._onVideoTimeUpdate=function(){if(this._adaptiveSource&&this._video){if(this._forcedAdBreak&&this._video.currentTime>this._forcedAdBreak.endTime){var e=this._targetTime;this._targetTime=void 0,this._forcedAdBreak=void 0,this._video.currentTime=e}if(this._adaptiveSource&&this._video&&!this._video.seeking&&this._adaptiveSource.onTimeUpdate(),"VOD"===this.playlistType&&!this._ended&&this._video.duration-this._video.currentTime<=.25){this._ended=!0;var t=new CustomEvent("ended");this._video.dispatchEvent(t),this._video.pause()}this.updateVideoRect()}},t.prototype._onVideoSeeking=function(){this._isSafari&&"EVENT"!=this.playlistType&&"LIVE"!=this.playlistType&&(this._isPaused=this._video.paused,this._video.pause())},t.prototype._onVideoSeeked=function(){this._isSafari&&!this._isPaused&&"EVENT"!=this.playlistType&&"LIVE"!=this.playlistType&&this._video.play()},t.prototype._onVideoPlaybackEnd=function(){this._adaptiveSource.videoPlaybackEnd()},t.prototype._onMediaSourceOpen=function(){this._adaptiveSource.initializeVideoElement(this._video,this._mediaSource,this._config.debug),this._adaptiveSource.load(this._url)},t.prototype._onID3Tag=function(t){e.prototype.fire.call(this,u.Events.ID3Tag,t)},t.prototype._onTxxxID3Frame=function(t){e.prototype.fire.call(this,u.Events.TxxxID3Frame,t)},t.prototype._onPrivID3Frame=function(t){e.prototype.fire.call(this,u.Events.PrivID3Frame,t)},t.prototype._onTextID3Frame=function(t){e.prototype.fire.call(this,u.Events.TextID3Frame,t)},t.prototype._onSliceEntered=function(t){e.prototype.fire.call(this,u.Events.SliceEntered,t)},t.prototype._onBeamLoaded=function(){var t=this;this._isUplynkUrl(this._adaptiveSource.domain)&&(this._assetInfoService=new o.AssetInfoService(this._protocol,this._adaptiveSource.domain,this._adaptiveSource.sessionId),this._pingService=new a.PingService(this._protocol,this._adaptiveSource.domain,this._adaptiveSource.sessionId,this._video)),this._video.textTracks.addEventListener("change",function(e){t.onTextTrackChanged(e)}),e.prototype.fire.call(this,u.Events.BeamLoaded)},t.prototype._onTrackLoaded=function(){e.prototype.fire.call(this,u.Events.TrackLoaded),this._firedReadyEvent||(this._firedReadyEvent=!0,e.prototype.fire.call(this,u.Events.Ready))},t.prototype._startMainLoop=function(){0===this._intervalId&&(this._intervalId=setInterval(this._onTimerTick,15))},t.prototype._stopMainLoop=function(){0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=0)},t.prototype._onTimerTick=function(){this._adaptiveSource.onTick()},t.prototype._isUplynkUrl=function(e){var t=e.toLowerCase();return t.indexOf("uplynk.com")>-1||t.indexOf("downlynk.com")>-1},t.prototype._onSourceLoaded=function(){var t=this;this._assetInfoService&&this._segmentMap?this._assetInfoService.loadSegmentMap(this._segmentMap,function(){if(t._adaptiveSource.start(),e.prototype.fire.call(t,u.Events.SourceLoaded),t._config.showPoster&&"VOD"===t.playlistType){var i=t._segmentMap.contentSegments[0],n=t._assetInfoService.getAssetInfo(i.id);n&&(t._video.poster=n.posterUrl)}}):(this._adaptiveSource.start(),e.prototype.fire.call(this,u.Events.SourceLoaded))},t.prototype._onLoadError=function(t,i){e.prototype.fire.call(this,u.Events.LoadError,{error:t,code:i})},t.prototype._onDrmError=function(t){e.prototype.fire.call(this,u.Events.DrmError,{error:t})},t.prototype._onSegmentMapChanged=function(){"VOD"===this.playlistType?this._segmentMap||(this._segmentMap=new d.SegmentMap(this._adaptiveSource.segmentMap),this._initSegmentTextTrack(),this._initAdBreakTextTrack(),e.prototype.fire.call(this,u.Events.SegmentMapLoaded,{segmentMap:this._segmentMap}),e.prototype.fire.call(this,u.Events.LoadedAdBreaks,{adBreaks:this._segmentMap.adBreaks})):(this._segmentMap=new d.SegmentMap(this._adaptiveSource.segmentMap),e.prototype.fire.call(this,u.Events.SegmentMapLoaded,{segmentMap:this._segmentMap}))},t.prototype._startLicenseRequest=function(e,t){this._licenseManager.setKeyServerPrefix(t),this._licenseManager.addLicenseRequest(e)},t.prototype._loadBandwidthHistory=function(){if((parseInt(localStorage.getItem("UplynkHistoryVersion"),10)||0)<2&&null!=localStorage.getItem("UplynkHistory"))return console.log("[adaptive-player.ts] _loadBandwidthHistory found an older history version. Removing it"),localStorage.removeItem("UplynkHistory"),localStorage.removeItem("UplynkHistoryTimestamp"),null;var e=localStorage.getItem("UplynkHistoryTimestamp"),t=parseInt(e,10)||0;if(Date.now()-t<36e5){var i=localStorage.getItem("UplynkHistory");return JSON.parse(i)}return null},t.prototype._saveBandwidthHistory=function(e){if(null!=e){var t=Date.now();localStorage.setItem("UplynkHistoryVersion","2"),localStorage.setItem("UplynkHistoryTimestamp",t.toString()),localStorage.setItem("UplynkHistory",JSON.stringify(e))}},t.prototype.getThumbnail=function(e,t){return void 0===t&&(t="small"),c.getThumbnail(e,this._segmentMap,this._assetInfoService,t)},t.prototype._initSegmentTextTrack=function(){var t=this;if("undefined"!=typeof VTTCue)for(var i=this._getOrCreateTextTrack("metadata","segments"),n=this,r=0;r<this._segmentMap.length;r++)!function(r){var o=n._segmentMap.getSegmentAt(r);if(o&&o.id&&""!==o.id){var a=new VTTCue(o.startTime,o.endTime,o.id);void 0!==a&&(a.addEventListener("enter",function(){t._assetInfoService?t._assetInfoService.loadSegment(o,function(i){e.prototype.fire.call(t,u.Events.AssetEntered,{segment:o,asset:i})}):e.prototype.fire.call(t,u.Events.AssetEntered,{segment:o,asset:null})}),a.addEventListener("exit",function(){t._assetInfoService?t._assetInfoService.loadSegment(o,function(i){e.prototype.fire.call(t,u.Events.AssetExited,{segment:o,asset:i})}):e.prototype.fire.call(t,u.Events.AssetEntered,{segment:o,asset:null})}),i.addCue(a))}}(r)},t.prototype._initAdBreakTextTrack=function(){var t=this;if("undefined"!=typeof VTTCue){var i=this._segmentMap.adBreaks;if(0!==i.length){for(var n=this._getOrCreateTextTrack("metadata","adbreaks"),r=0;r<i.length;r++)!function(r){var o=i[r],a=new VTTCue(o.startTime,o.endTime,"adbreak");void 0!==a&&(a.addEventListener("enter",function(){e.prototype.fire.call(t,u.Events.AdBreakEntered,{adBreak:o})}),a.addEventListener("exit",function(){e.prototype.fire.call(t,u.Events.AdBreakExited,{adBreak:o})}),n.addCue(a))}(r);this._isFirefox&&!this._video.autoplay&&0===i[0].startTime&&0===this._video.currentTime&&e.prototype.fire.call(this,u.Events.AdBreakEntered,{adBreak:i[0]})}}},t.prototype._getOrCreateTextTrack=function(e,t){for(var i=0;i<this._video.textTracks.length;i++){var n=this._video.textTracks[i];if(n.kind===e&&n.label===t)return n}return this._video.addTextTrack(e,t)},t.prototype.onTextTrackChanged=function(e){this._adaptiveSource.onTextTrackChanged(e)},t.prototype.updateVideoRect=function(){var e=this._video.getBoundingClientRect();this._videoRect&&this._videoRect.width==e.width&&this._videoRect.height==e.height||(this._videoRect=e,this._adaptiveSource&&this._config.limitResolutionToViewSize&&this._adaptiveSource.setMaxVideoResolution(e.height,e.width))},t.prototype._onAudioTrackSwitched=function(){e.prototype.fire.call(this,u.Events.AudioTrackSwitched)},Object.defineProperty(t.prototype,"audioTracks",{get:function(){return this._adaptiveSource.audioTracks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){for(var e=this.audioTracks,t=0;t<e.length;t++)if(e[t].enabled)return e[t];return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrackId",{get:function(){return this._adaptiveSource.audioTrackId},set:function(e){this._adaptiveSource.audioTrackId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"domain",{get:function(){return this._adaptiveSource.domain},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._adaptiveSource.sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRays",{get:function(){return this._adaptiveSource.numberOfRays},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableBandwidths",{get:function(){return this._adaptiveSource.availableBandwidths},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableResolutions",{get:function(){return this._adaptiveSource.availableResolutions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableMimeTypes",{get:function(){return this._adaptiveSource.availableMimeTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentMap",{get:function(){return this._segmentMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adBreaks",{get:function(){return this._segmentMap.adBreaks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._adaptiveSource?this._adaptiveSource.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playlistType",{get:function(){return this._adaptiveSource.playlistType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsThumbnails",{get:function(){return this.availableResolutions.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"AdaptivePlayer"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return"02.00.18061400"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoBuffered",{get:function(){return this._adaptiveSource.videoBuffered},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioBuffered",{get:function(){return this._adaptiveSource.audioBuffered},enumerable:!0,configurable:!0}),t}(r.Observable);i.AdaptivePlayer=f},{"./events":3,"./id3/id3-handler":5,"./license-manager":7,"./utils/observable":13,"./utils/segment-map":14,"./utils/thumbnail-helper":16,"./utils/utils":17,"./web-services/asset-info-service":18,"./web-services/ping-service":19}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Events={BeamLoaded:"beamloaded",TrackLoaded:"trackloaded",SourceLoaded:"sourceloaded",LoadError:"loaderror",DrmError:"drmerror",SegmentMapLoaded:"segmentmapLoaded",LoadedAdBreaks:"loadedadbreaks",ID3Tag:"id3Tag",TxxxID3Frame:"txxxId3Frame",PrivID3Frame:"privId3Frame",TextID3Frame:"textId3Frame",SliceEntered:"sliceEntered",AssetEntered:"assetentered",AssetExited:"assetexited",AdBreakEntered:"adbreakentered",AdBreakExited:"adbreakexited",Ready:"ready",AudioTrackSwitched:"audioTrackSwitched",AudioTrackAdded:"audioTrackAdded"}},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("../utils/utils"),r=function(){function e(){}return e.getFrame=function(e){if(!(e.length<21)&&73===e[0]&&68===e[1]&&51===e[2]){var t=String.fromCharCode(e[10],e[11],e[12],e[13]),i=0;i=e[14]<<24,i|=e[15]<<16,i|=e[16]<<8,i|=e[17];return{type:t,size:i,data:n.slice(e,20)}}},e.decodeTextFrame=function(t){if(!(t.size<2)&&3===t.data[0]){var i=n.slice(t.data,1);return{value:e.utf8ArrayToStr(i)}}},e.decodeTxxxFrame=function(t){if(!(t.size<2)&&3===t.data[0]){var i=1,r=e.utf8ArrayToStr(n.slice(t.data,i));i+=r.length+1;return{description:r,value:e.utf8ArrayToStr(n.slice(t.data,i))}}},e.decodePrivFrame=function(e){if(!(e.size<2)){for(var t=0,i=0;i<e.data.length;i++)if(0===e.data[i]){t=i;break}return{owner:String.fromCharCode.apply(null,n.slice(e.data,0,t)),data:n.slice(e.data,t+1)}}},e.utf8ArrayToStr=function(e){for(var t,i,n="",r=0,o=e.length;r<o;){var a=e[r++];switch(a>>4){case 0:return n;case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(a);break;case 12:case 13:t=e[r++],n+=String.fromCharCode((31&a)<<6|63&t);break;case 14:t=e[r++],i=e[r++],n+=String.fromCharCode((15&a)<<12|(63&t)<<6|(63&i)<<0)}}return n},e}();i.ID3Decoder=r},{"../utils/utils":17}],5:[function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=e("../utils/observable"),o=e("./id3-decoder"),a=e("../utils/utils"),s=function(e){function t(t){var i=e.call(this)||this;return t.textTracks.addEventListener("addtrack",i._onAddTrack.bind(i)),i}return n(t,e),t.prototype._onAddTrack=function(e){var t=e.track;this._isId3MetadataTrack(t)&&(t.mode="hidden",t.addEventListener("cuechange",this._onID3CueChange.bind(this)))},t.prototype._isId3MetadataTrack=function(e){if("metadata"==e.kind&&"ID3"==e.label)return!0;if("metadata"==e.kind&&e.inBandMetadataTrackDispatchType){var t=e.inBandMetadataTrackDispatchType;return"com.apple.streaming"===t||"15260DFFFF49443320FF49443320000F"===t}return!1},t.prototype._onID3CueChange=function(e){for(var t=this,i=e.target,n=0;n<i.activeCues.length;n++){var r=i.activeCues[n];r.onenter||this._onID3Cue(r)}for(var n=0;n<i.cues.length;n++){var r=i.cues[n];r.onenter||(r.onenter=function(e){t._onID3Cue(e.target)})}},t.prototype._onID3Cue=function(i){var n=void 0,r=void 0,s=void 0,d=void 0,c=void 0;if(i.data)n=new Uint8Array(i.data);else if(i.value&&i.value.key&&i.value.data){if("TXXX"===i.value.key){var u=i.value;s={value:u.data,description:void 0}}else if("PRIV"===i.value.key){var p=i.value;c={owner:p.info,data:new Uint8Array(p.data)}}}else n=a.base64ToBuffer(i.text);if(n&&(r=o.ID3Decoder.getFrame(n))&&("TXXX"===r.type?s=o.ID3Decoder.decodeTxxxFrame(r):"PRIV"===r.type?c=o.ID3Decoder.decodePrivFrame(r):"T"===r.type[0]&&(d=o.ID3Decoder.decodeTextFrame(r))),r){var l={cue:i,frame:r};e.prototype.fire.call(this,t.Event.ID3Tag,l)}if(s){var h={cue:i,frame:s};if(e.prototype.fire.call(this,t.Event.TxxxID3Frame,h),s.value){var f=s.value.split("_");if(3==f.length){var _={cue:i,assetId:f[0],rayChar:f[1],sliceIndex:parseInt(f[2],16)};e.prototype.fire.call(this,t.Event.SliceEntered,_)}}}else if(c){var v={cue:i,frame:c};e.prototype.fire.call(this,t.Event.PrivID3Frame,v)}else if(d){var y={cue:i,frame:d};e.prototype.fire.call(this,t.Event.TextID3Frame,y)}},Object.defineProperty(t,"Event",{get:function(){return{ID3Tag:"id3Tag",TxxxID3Frame:"txxxId3Frame",PrivID3Frame:"privId3Frame",TextID3Frame:"textId3Frame",SliceEntered:"sliceEntered"}},enumerable:!0,configurable:!0}),t}(r.Observable);i.ID3Handler=s},{"../utils/observable":13,"../utils/utils":17,"./id3-decoder":4}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./utils/utils"),r=function(){function e(e){this._video=e,this._certificatePath=null,this._certificateData=null;var t=this;this._video.addEventListener("webkitneedkey",function(e){t._onWebKitNeedKey(e.target,e.initData)})}return e.prototype.load=function(e){if(this._certificatePath=e,null==this._certificatePath||""==this._certificatePath)return void console.error("[LicenseManagerFP] No Fairplay certificate path given. Cannot play.");if(void 0===WebKitMediaKeys)return void console.error("[LicenseManagerFP] No Fairplay browser support detected. Cannot play.");var t=this,i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)throw"[LicenseManagerFP] - Failed to retrieve the server certificate ("+t._certificatePath+"). Status: "+i.status+" ("+i.statusText+")";t.onCertificateLoaded(i.response)}},i.open("GET",this._certificatePath,!0),i.setRequestHeader("Pragma","Cache-Control: no-cache"),i.setRequestHeader("Cache-Control","max-age=0"),i.send()},e.prototype.onCertificateLoaded=function(e){this._certificateData=new Uint8Array(e),console.log("[LicenseManagerFP] Certificate loaded successfully"),this._video.load()},e.prototype._onWebKitNeedKey=function(e,t){if(null===t)return void console.error("Fairplay DRM needs a key, but no init data available.");if(null===this._certificateData)return void console.error("Fairplay DRM needs a key, but no certificate data available.");var i=this.getSPCUrl(t),n=this.extractContentId(i),r=this.concatInitDataIdAndCertificate(t,n);if(!e.webkitKeys){var o=this.selectKeySystem();e.webkitSetMediaKeys(new WebKitMediaKeys(o))}if(!e.webkitKeys)throw"Could not create MediaKeys";var a=e.webkitKeys.createSession("video/mp4",r);if(!a)throw"Could not create key session";a.contentId=n,a.destinationURL=i;var s=this;a.addEventListener("webkitkeymessage",function(e){s.licenseRequestReady(e.target,e.message)}),a.addEventListener("webkitkeyadded",function(e){s.onkeyadded()}),a.addEventListener("webkitkeyerror",function(e){s.onkeyerror()})},e.prototype.extractContentId=function(e){var t=document.createElement("a");return t.href=e,t.search.substr(1).split("&")[0].split("=")[1]},e.prototype.getSPCUrl=function(e){var t=n.array16ToString(e),i=t.replace("skd://","https://");return i=i.substring(1,i.length)},e.prototype.concatInitDataIdAndCertificate=function(e,t){"string"==typeof t&&(t=n.stringToArray16(t));var i=0,r=new ArrayBuffer(e.byteLength+4+t.byteLength+4+this._certificateData.byteLength),o=new DataView(r);new Uint8Array(r,i,e.byteLength).set(e),i+=e.byteLength,o.setUint32(i,t.byteLength,!0),i+=4;var a=new Uint8Array(r,i,t.byteLength);return a.set(t),i+=a.byteLength,o.setUint32(i,this._certificateData.byteLength,!0),i+=4,new Uint8Array(r,i,this._certificateData.byteLength).set(this._certificateData),new Uint8Array(r,0,r.byteLength)},e.prototype.selectKeySystem=function(){if(WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4"))return"com.apple.fps.1_0";throw"Key System not supported"},e.prototype.licenseRequestReady=function(e,t){var i=this,r=new XMLHttpRequest;r.responseType="json",r.session=e,r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status){var t=JSON.stringify(e.response);throw"[LicenseManagerFP] license request failed "+(t||"")+"("+e.destinationURL+"). Status: "+r.status+" ("+r.statusText+")"}i.licenseRequestLoaded(r.response,r.session)}};var o={};o.spc=n.base64EncodeUint8Array(t),o.assetId=e.contentId,r.open("POST",e.destinationURL,!0),r.send(JSON.stringify(o)),window.console.log("[LicenseManagerFP] Fairplay key requested for asset "+e.contentId)},e.prototype.licenseRequestLoaded=function(e,t){var i=n.base64DecodeUint8Array(e.ckc);t.update(i)},e.prototype.onkeyerror=function(){window.console.error("[LicenseManagerFP] Fairplay decryption key error was encountered")},e.prototype.onkeyadded=function(){window.console.log("[LicenseManagerFP] Fairplay decryption key was added to session.")},e}();i.LicenseManagerFP=r},{"./utils/utils":17}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./utils/utils"),r=(function(){function e(){}}(),function(){function e(e,t){this.LICENSE_TYPE_WIDEVINE="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",this.LICENSE_TYPE_PLAYREADY="9a04f079-9840-4286-ab92-e65be0885f95",this._licenseType="",this.playreadyKeySystem={keySystem:"com.microsoft.playready",supportedConfig:[{initDataTypes:["keyids","cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a"',robustness:""}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1"',robustness:""}]}]},this.widevineKeySystem={keySystem:"com.widevine.alpha",supportedConfig:[{label:"foo",initDataTypes:["cenc"],sessionTypes:["temporary"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.5"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.4d001f"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.4d001e"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.4d0016"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.42000d"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.42000c"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.42000b"',robustness:"SW_SECURE_CRYPTO"}]}]},this._video=e,this._adaptiveSource=t,this._keyServerPrefix=null,this._pssh=null,this._mediaKeys=null,this._mediaKeysError=null,this._keyRequests=[],this._pendingKeyRequests=[],this.initMediaKeys()}return e.prototype.addLicenseRequest=function(e){for(var t=0;t<this._keyRequests.length;t++)if(e.widevine===this._keyRequests[t].widevine)return;for(var t=0;t<this._pendingKeyRequests.length;t++)if(e.widevine===this._pendingKeyRequests[t].widevine)return;this._pendingKeyRequests.push(e),this.processPendingKeys(this)},e.prototype.setKeyServerPrefix=function(e){this._keyServerPrefix=e},e.prototype.initMediaKeys=function(){var e=this;this._mediaKeys=null,navigator.requestMediaKeySystemAccess&&navigator.requestMediaKeySystemAccess(e.widevineKeySystem.keySystem,e.widevineKeySystem.supportedConfig).then(function(t){e._licenseType=e.LICENSE_TYPE_WIDEVINE,t.createMediaKeys().then(function(t){e.onMediaKeyAcquired(e,t)})},function(){navigator.requestMediaKeySystemAccess(e.playreadyKeySystem.keySystem,e.playreadyKeySystem.supportedConfig).then(function(t){e._licenseType=e.LICENSE_TYPE_PLAYREADY,t.createMediaKeys().then(function(t){e.onMediaKeyAcquired(e,t)})}).catch(function(t){e._mediaKeysError="[LicenseManager] Your browser/system does not support the requested configurations for playing protected content."})}).catch(function(t){e._mediaKeysError="[LicenseManager] Your browser/system does not support the requested configurations for playing protected content."})},e.prototype.onMediaKeyAcquired=function(e,t){e._mediaKeys=t,e._video.setMediaKeys(e._mediaKeys),e.processPendingKeys(e)},e.prototype.processPendingKeys=function(e){if(null!==e._mediaKeys||null!==e._mediaKeysError){if(null===e._mediaKeys&&null!==e._mediaKeysError)return void e._adaptiveSource.signalDrmError(e._mediaKeysError);for(;e._pendingKeyRequests.length>0;){var t=e._pendingKeyRequests.shift();this._keyRequests.push(t),console.log("[LicenseManager] starting license update for DRM playback"),e._licenseType===this.LICENSE_TYPE_WIDEVINE?e.getNewKeySession(n.base64ToBuffer(t.widevine)):e._licenseType===this.LICENSE_TYPE_PLAYREADY&&e.getNewKeySession(n.base64ToBuffer(t.playready))}}},e.prototype.getNewKeySession=function(e){var t=this,i=t._mediaKeys.createSession("temporary");i.addEventListener("message",function(e){t.downloadNewKey(t.getLicenseUrl(),e.message,function(i){e.target.update(i).catch(function(e){t._adaptiveSource.signalDrmError("[LicenseManager] call to MediaKeySession.update() failed: "+e)}),console.log("[LicenseManager] finished license update for DRM playback")})},!1),i.generateRequest("cenc",e).catch(function(e){t._adaptiveSource.signalDrmError("[LicenseManager] keySession.generateRequest() failed: "+e)})},e.prototype.getLicenseUrl=function(){return this._licenseType===this.LICENSE_TYPE_PLAYREADY?this._keyServerPrefix+"/pr":this._licenseType===this.LICENSE_TYPE_WIDEVINE?this._keyServerPrefix+"/wv":""},e.prototype.downloadNewKey=function(e,t,i){var r,o=this,a=new XMLHttpRequest;if(a.open("POST",e,!0),a.withCredentials=!1,a.responseType="arraybuffer",a.onreadystatechange=function(){4===a.readyState&&(200===a.status?i(a.response):o._adaptiveSource.signalDrmError("[LicenseManager] XHR failed ("+e+"). Status: "+a.status+" ("+a.statusText+")"))},this._licenseType===this.LICENSE_TYPE_PLAYREADY){var s=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new Uint16Array(t)),"application/xml");s.getElementsByTagName("Challenge")[0]?r=n.base64ToBuffer(s.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue).buffer:o._adaptiveSource.signalDrmError("Cannot find <Challenge> in key message");var d=s.getElementsByTagName("name"),c=s.getElementsByTagName("value");d.length!==c.length&&o._adaptiveSource.signalDrmError("Mismatched header <name>/<value> pair in key message");for(var u=0;u<d.length;u++)a.setRequestHeader(d[u].childNodes[0].nodeValue,c[u].childNodes[0].nodeValue)}else this._licenseType===this.LICENSE_TYPE_WIDEVINE&&(r=t);a.send(r)},e}());i.LicenseManager=r},{"./utils/utils":17}],8:[function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=e("./utils/observable"),o=e("./events"),a=e("./ad/ad-break"),s=e("./id3/id3-handler"),d=e("./web-services/asset-info-service"),c=e("./web-services/ping-service"),u=e("./utils/utils"),p=e("./license-manager-fp"),l=function(e){function t(t,i){var n=e.call(this)||this;n._defaults={disableSeekDuringAdBreak:!0,showPoster:!1,debug:!1};var r={};try{r=JSON.parse(t.getAttribute("data-config"))}catch(e){}return n._config=Object.assign({},n._defaults,i,r),n._video=t,n._id3Handler=new s.ID3Handler(t),n._id3Handler.on(s.ID3Handler.Event.ID3Tag,n._onID3Tag.bind(n)),n._id3Handler.on(s.ID3Handler.Event.TxxxID3Frame,n._onTxxxID3Frame.bind(n)),n._id3Handler.on(s.ID3Handler.Event.PrivID3Frame,n._onPrivID3Frame.bind(n)),
n._id3Handler.on(s.ID3Handler.Event.TextID3Frame,n._onTextID3Frame.bind(n)),n._id3Handler.on(s.ID3Handler.Event.SliceEntered,n._onSliceEntered.bind(n)),n._onDurationChange=n._onDurationChange.bind(n),n._overrideCurrentTime(),n}return n(t,e),t.prototype.prepareLoad=function(e){this._protocol=u.getProtocol(e),this._firedReadyEvent=!1,this._currentAssetId=null,this._video.removeEventListener("durationchange",this._onDurationChange),this._video.addEventListener("durationchange",this._onDurationChange),this._video.audioTracks&&this._video.audioTracks.addEventListener("addtrack",this._onAudioTrackAdded.bind(this)),this._sessionId=this._getSessionId(e),this._domain=this._getDomain(e),this._licenseManagerFP=new p.LicenseManagerFP(this._video),this._isUplynkUrl(e)&&(this._assetInfoService=new d.AssetInfoService(this._protocol,this.domain)),"content.uplynk.com"!==this._domain&&(this._pingService=new c.PingService(this._protocol,this.domain,this._sessionId,this._video)),this._url=e,this._video.src=e},t.prototype.load=function(e){var t=null,i=null;"string"==typeof e?t=e:(t=e.url,null!=e.fairplayCertificatePath&&(i=e.fairplayCertificatePath)),this.prepareLoad(t),i?(console.log("Loading with Fairplay"),this._licenseManagerFP.load(i)):this._video.load()},t.prototype.destroy=function(){this._video.src=null},t.prototype._overrideCurrentTime=function(){var e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");if(e){var t=e.get,i=e.set,n=this;Object.defineProperty(this._video,"currentTime",{get:function(){return t.apply(this)},set:function(e){n.canSeek()&&i.apply(this,[e])},enumerable:!1,configurable:!1})}},t.prototype.canSeek=function(){return!this._config.disableSeekDuringAdBreak||!this._inAdBreak},t.prototype._getSessionId=function(e){var t=RegExp("[?&]pbs=([^&]*)").exec(e);return t&&decodeURIComponent(t[1].replace(/\+/g," "))},t.prototype._getDomain=function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.hostname},t.prototype._isUplynkUrl=function(e){var t=e.toLowerCase();return t.indexOf("uplynk.com")>-1||t.indexOf("downlynk.com")>-1},t.prototype._onDurationChange=function(){this._video.duration===1/0?this._playlistType="LIVE":this._playlistType="VOD",this._firedReadyEvent||(this._firedReadyEvent=!0,e.prototype.fire.call(this,o.Events.Ready))},Object.defineProperty(t,"Event",{get:function(){return o.Events},enumerable:!0,configurable:!0}),t.prototype.setBrowser=function(e,t,i,n){},t.prototype.getThumbnail=function(e,t){return null},Object.defineProperty(t.prototype,"audioTracks",{get:function(){return this._video.audioTracks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrackId",{get:function(){var e=this.audioTrack;return null!=e?parseInt(e.id):0},set:function(e){for(var t=this.audioTracks,i=0;i<t.length;i++)if(parseInt(t[i].id)===e)return void(t[i].enabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){for(var e=this.audioTracks,t=0;t<e.length;t++)if(e[t].enabled)return e[t];return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"domain",{get:function(){return this._domain},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playlistType",{get:function(){return this._playlistType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._video.duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsThumbnails",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return"NativePlayer"},enumerable:!0,configurable:!0}),t.prototype._onID3Tag=function(t){e.prototype.fire.call(this,o.Events.ID3Tag,t)},t.prototype._onTxxxID3Frame=function(t){e.prototype.fire.call(this,o.Events.TxxxID3Frame,t)},t.prototype._onPrivID3Frame=function(t){e.prototype.fire.call(this,o.Events.PrivID3Frame,t)},t.prototype._onTextID3Frame=function(t){e.prototype.fire.call(this,o.Events.TextID3Frame,t)},t.prototype._onAudioTrackAdded=function(t){e.prototype.fire.call(this,o.Events.AudioTrackAdded,t)},t.prototype._onSliceEntered=function(t){var i=this;e.prototype.fire.call(this,o.Events.SliceEntered,t),this._assetInfoService&&(null===this._currentAssetId?this._assetInfoService.loadAssetId(t.assetId,null,function(e){i._currentAssetId=t.assetId,i._onAssetEncountered(t.cue,e)}):this._currentAssetId!==t.assetId&&this._assetInfoService.loadAssetId(this._currentAssetId,null,function(e){i._assetInfoService.loadAssetId(t.assetId,null,function(n){i._currentAssetId=t.assetId,i._onNewAssetEncountered(t.cue,e,n)})}))},t.prototype._onAssetEncountered=function(t,i){var n=void 0;if(i.isAd){n={id:i.asset,index:0,startTime:t.startTime,endTime:t.startTime+i.duration,type:"AD"};var r=[n];this._currentAdBreak=new a.AdBreak(r),this._inAdBreak=!0,e.prototype.fire.call(this,o.Events.AssetEntered,{segment:n,asset:i}),e.prototype.fire.call(this,o.Events.AdBreakEntered,{adBreak:this._currentAdBreak})}else this._inAdBreak=!1,e.prototype.fire.call(this,o.Events.AssetEntered,{segment:void 0,asset:i})},t.prototype._onNewAssetEncountered=function(t,i,n){this._inAdBreak=n.isAd,i.isAd&&this._currentAdBreak?(e.prototype.fire.call(this,o.Events.AssetExited,{segment:this._currentAdBreak.getSegmentAt(0),asset:i}),e.prototype.fire.call(this,o.Events.AdBreakExited,{adBreak:this._currentAdBreak})):e.prototype.fire.call(this,o.Events.AssetExited,{segment:void 0,asset:i}),this._onAssetEncountered(t,n)},t.prototype.onTextTrackChanged=function(e){},Object.defineProperty(t.prototype,"version",{get:function(){return"02.00.18061400"},enumerable:!0,configurable:!0}),t}(r.Observable);i.NativePlayer=l},{"./ad/ad-break":1,"./events":3,"./id3/id3-handler":5,"./license-manager-fp":6,"./utils/observable":13,"./utils/utils":17,"./web-services/asset-info-service":18,"./web-services/ping-service":19}],9:[function(e,t,i){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var o=t[r];if(e.call(n,o,r,t))return o;r++}}})},{}],10:[function(e,t,i){"function"!=typeof Object.assign&&function(){Object.assign=function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t}}()},{}],11:[function(e,t,i){!function(){window.VTTCue=window.VTTCue||window.TextTrackCue}()},{}],12:[function(e,t,i){"use strict";function n(){try{var e=document.createElement("video");if(e.canPlayType)return""!==e.canPlayType("application/vnd.apple.mpegurl")}catch(e){return!1}return!1}function r(){return!!("MediaSource"in window&&MediaSource.isTypeSupported)&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}function o(){var e=document.getElementsByTagName("script");if(e&&e.length)for(var t=0;t<e.length;t++)if(e[t].src.indexOf("uplynk-core.js")>-1||e[t].src.indexOf("uplynk-core.min.js")>-1)return e[t]}function a(e,t,i){var n=o().src.substring(0,o().src.lastIndexOf("/")+1)+"uplynk-adaptive.js";d(n)?l?i(new u.AdaptivePlayer(e,t)):setTimeout(function(){a(e,t,i)},500):(l=!1,s(n,function(){l=!0,i(new u.AdaptivePlayer(e,t))}))}function s(e,t){var i=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=function(){t()},i.appendChild(n)}function d(e){var t=document.getElementsByTagName("script");if(t&&t.length)for(var i=0;i<t.length;i++)if(t[i].src===e)return!0;return!1}function c(e,t,i){if(t.preferNativePlayback){if(n())return void i(new p.NativePlayer(e,t));if(r())return void a(e,t,i)}else{if(r())return void a(e,t,i);if(n())return void i(new p.NativePlayer(e,t))}console.warn("no playback mode supported"),i(void 0)}Object.defineProperty(i,"__esModule",{value:!0}),e("./polyfill/vtt-cue"),e("./polyfill/object"),e("./polyfill/array");var u=e("./adaptive-player"),p=e("./native-player"),l=!0;window.createAdaptivePlayer=c,window.AdaptivePlayer=u.AdaptivePlayer},{"./adaptive-player":2,"./native-player":8,"./polyfill/array":9,"./polyfill/object":10,"./polyfill/vtt-cue":11}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./string-map"),r=function(){function e(){this._listeners=new n.StringMap}return e.prototype.on=function(e,t){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)},e.prototype.off=function(e,t){var i,n=this,r=this._listeners.get(e);return!!(r&&r.length&&(i=r.reduce(function(e,i,r){return n._isFunction(i)&&i===t?e=r:e},-1))>-1)&&(r.splice(i,1),this._listeners.set(e,r),!0)},e.prototype.fire=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=this._listeners.get(e);return!(!n||!n.length)&&(n.forEach(function(e){e.apply(void 0,t)}),!0)},e.prototype._isFunction=function(e){return"function"==typeof e||!1},e}();i.Observable=r},{"./string-map":15}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("../ad/ad-break"),r=function(){function e(e){this._segments=e,this._adBreaks=[],this._initAdbreaks()}return e.prototype.findSegment=function(e){var t=this.getSegmentIndexAt(e);return this.getSegmentAt(t)},e.prototype.getSegmentAt=function(e){if(e>=0&&e<this._segments.length)return this._segments[e]},e.prototype.getSegmentIndexAt=function(e){for(var t=0;t<this._segments.length;t++){var i=this._segments[t];if(i.startTime<=e&&e<=i.endTime)return t}return-1},Object.defineProperty(e.prototype,"length",{get:function(){return this._segments.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adBreaks",{get:function(){return this._adBreaks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSegments",{get:function(){return this._segments.filter(e.isContent)},enumerable:!0,configurable:!0}),e.isAd=function(e){return"AD"===e.type},e.isContent=function(e){return"CONTENT"===e.type},e.prototype._initAdbreaks=function(){for(var t=[],i=0;i<this._segments.length;i++){for(;i<this._segments.length&&e.isAd(this._segments[i]);)t.push(this._segments[i]),i++;t.length>0&&(this._adBreaks.push(new n.AdBreak(t)),t=[])}},e.prototype.inAdBreak=function(e){for(var t=0;t<this._adBreaks.length;t++){if(this._adBreaks[t].contains(e))return!0}return!1},e.prototype.getAdBreak=function(e){return this._adBreaks.find(function(t){return t.contains(e)})},e.prototype.getAdBreaksBetween=function(e,t){return this._adBreaks.filter(function(i){return e<=i.startTime&&i.endTime<=t})},e}();i.SegmentMap=r},{"../ad/ad-break":1}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(){this._map=new Object}return Object.defineProperty(e.prototype,"size",{get:function(){return Object.keys(this._map).length},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.hasOwnProperty(e)},e.prototype.get=function(e){return this._map[e]},e.prototype.set=function(e,t){this._map[e]=t},e.prototype.clear=function(){for(var e=Object.keys(this._map),t=0;t<e.length;t++){var i=e[t];this._map[i]=null,delete this._map[i]}},e}();i.StringMap=n},{}],16:[function(e,t,i){"use strict";function n(e,t,i,n){if(void 0===n&&(n="small"),(isNaN(e)||e<0)&&(e=0),i&&t){var s=t.findSegment(e);if(s){var d=i.getAssetInfo(s.id);if(d&&d.thumbs){var c=a(e,s,d),u=o(d,n);return{url:r(d,c,u),height:u.height,width:u.width}}}}return{url:"",height:0,width:0}}function r(e,t,i){var n=e.thumbPrefix;if(e.storagePartitions&&e.storagePartitions.length)for(var r=0;r<e.storagePartitions.length;r++){var o=e.storagePartitions[r];if(o.start<=t&&t<o.end){n=o.url;break}}"/"!==n[n.length-1]&&(n+="/");var a=s.toHexString(t);return""+n+i.prefix+a+".jpg"}function o(e,t){var i=e.thumbs[0];return"large"===t&&(i=e.thumbs[e.thumbs.length-1]),i}function a(e,t,i){var n=Math.ceil((e-t.startTime)/i.sliceDuration);return n+=t.index,n>i.maxSlice&&(n=i.maxSlice),n}Object.defineProperty(i,"__esModule",{value:!0});var s=e("./utils");i.getThumbnail=n},{"./utils":17}],17:[function(e,t,i){"use strict";function n(e){isNaN(e)&&(e=0);var t=e<0?"-":"";e=Math.abs(e);var i=e%60|0,n=e/60%60|0,r=e/60/60%60|0,o=r>0,a=r<10?"0"+r:""+r,s=n<10?"0"+n:""+n,d=i<10?"0"+i:""+i;return o?""+t+a+":"+s+":"+d:""+t+s+":"+d}function r(e,t){void 0===t&&(t=8);for(var i=e.toString(16).toUpperCase();i.length<t;)i="0"+i;return i}function o(e){return new Uint8Array(atob(e).split("").map(function(e){return e.charCodeAt(0)}))}function a(e,t,i){return e.slice?e.slice(t,i):i?e.subarray(t,i):e.subarray(t)}function s(){if(!("localStorage"in window))return!1;try{window.localStorage.setItem("___test","OK");var e=window.localStorage.getItem("___test");return window.localStorage.removeItem("___test"),"OK"===e}catch(e){return!1}}function d(e){try{return new URL(e).protocol}catch(e){}var t=document.createElement("a");return t.setAttribute("href",e),t.protocol}function c(){var e=-1!==navigator.appVersion.indexOf("Windows NT")&&-1!==navigator.appVersion.indexOf("rv:11"),t=-1!==navigator.appVersion.indexOf("Edge");return e||t}function u(e){for(var t=new ArrayBuffer(2*e.length),i=new Uint16Array(t),n=0,r=e.length;n<r;n++)i[n]=e.charCodeAt(n);return i}function p(e){var t=new Uint16Array(e.buffer);return String.fromCharCode.apply(null,t)}function l(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(new ArrayBuffer(i)),r=0;r<i;r++)n[r]=t.charCodeAt(r);return n}function h(e){for(var t,i,n,r,o,a,s,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;u<e.length;)t=e[u++],i=u<e.length?e[u++]:Number.NaN,n=u<e.length?e[u++]:Number.NaN,r=t>>2,o=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),c+=d.charAt(r)+d.charAt(o)+d.charAt(a)+d.charAt(s);return c}Object.defineProperty(i,"__esModule",{value:!0}),i.toTimeString=n,i.toHexString=r,i.base64ToBuffer=o,i.slice=a,i.isLocalStorageAvailable=s,i.getProtocol=d,i.isIE11OrEdge=c,i.stringToArray16=u,i.array16ToString=p,i.base64DecodeUint8Array=l,i.base64EncodeUint8Array=h},{}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=e("../utils/segment-map"),o=e("../utils/string-map");!function(e){e[e.NotAvailable=-1]="NotAvailable",e[e.NotApplicable=0]="NotApplicable",e[e.TV_Y=1]="TV_Y",e[e.TV_Y7=2]="TV_Y7",e[e.TV_G=3]="TV_G",e[e.TV_PG=4]="TV_PG",e[e.TV_14=5]="TV_14",e[e.TV_MA=6]="TV_MA",e[e.NotRated=7]="NotRated"}(n||(n={}));var a;!function(e){e[e.NotAvailable=-1]="NotAvailable",e[e.NotApplicable=0]="NotApplicable",e[e.G=1]="G",e[e.PG=2]="PG",e[e.PG_13=3]="PG_13",e[e.R=4]="R",e[e.NC_17=5]="NC_17",e[e.X=6]="X",e[e.NotRated=7]="NotRated"}(a||(a={}));var s=function(){function e(e,t){if(this.audioOnly=1==e.audio_only,this.error=1==e.error,this.tvRating=e.tv_rating,this.storagePartitions=e.storage_partitions,this.maxSlice=e.max_slice,this.thumbPrefix=e.thumb_prefix,this.adData=e.ad_data,this.sliceDuration=e.slice_dur,this.movieRating=e.movie_rating,this.owner=e.owner,this.rates=e.rates,this.thumbs=e.thumbs,this.posterUrl=e.poster_url,this.duration=e.duration,this.defaultPosterUrl=e.default_poster_url,this.description=e.desc,this.ratingFlags=e.rating_flags,this.externalId=e.external_id,this.asset=e.asset,this.isAd=null==t?1===e.is_ad:t,this.thumbs&&this.thumbs.sort(function(e,t){return e.width-t.width}),this.storagePartitions&&this.storagePartitions.length)for(var i=0;i<this.storagePartitions.length;i++)this.storagePartitions[i].end=Math.min(this.storagePartitions[i].end,9007199254740991)}return e}();i.AssetInfo=s;var d=function(){function e(e,t,i){this._protocol=e,this._domain=t,this._sessionId=i,this._cache=new o.StringMap,this._loadSegments=this._loadSegments.bind(this)}return e.prototype.loadSegmentMap=function(e,t){if(e){for(var i=[],n=0;n<e.length;n++){var r=e.getSegmentAt(n);r.id&&""!==r.id&&i.push(r)}this._loadSegments(i,t)}},e.prototype._loadSegments=function(e,t){var i=this;if(0==e.length)return void t();var n=e.shift();this.loadSegment(n,function(){i._loadSegments(e,t)})},e.prototype.loadAssetId=function(e,t,i){var n=this;if(this.isLoaded(e)){var r=this._cache.get(e);return void i(r)}var o=this._protocol+"//"+this._domain+"/player/assetinfo/"+e+".json";this._sessionId&&""!=this._sessionId&&(o=o+"?pbs="+this._sessionId);var a=new XMLHttpRequest;a.onloadend=function(){if(200==a.status){var r=JSON.parse(a.responseText),o=new s(r,t);n._cache.set(e,o),i(o)}else i(null)},a.open("GET",o),a.send()},e.prototype.loadSegment=function(e,t){var i=e.id,n=r.SegmentMap.isAd(e);this.loadAssetId(i,n,t)},e.prototype.isLoaded=function(e){return this._cache.has(e)},e.prototype.getAssetInfo=function(e){if(this.isLoaded(e)){return this._cache.get(e)}},e.prototype.clear=function(){this._cache.clear()},e}();i.AssetInfoService=d},{"../utils/segment-map":14,"../utils/string-map":15}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t,i,n){this.START="start",this.SEEK="seek",this._protocol=e,this._domain=t,this._sessionId=i,this._video=n,this._pingServer=null!=i&&""!=i,this._nextTime=void 0,this._sentStartPing=!1,this._seeking=!1,this._currentTime=0,this._seekFromTime=0,this._video=n,this._onPlayerPositionChanged=this._onPlayerPositionChanged.bind(this),this._onStart=this._onStart.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onSeeking=this._onSeeking.bind(this),this._pingServer&&(this._video.addEventListener("timeupdate",this._onPlayerPositionChanged),this._video.addEventListener("playing",this._onStart),this._video.addEventListener("seeked",this._onSeeked),this._video.addEventListener("seeking",this._onSeeking))}return e.prototype._createQueryString=function(e,t,i){if(e){var n="v=3&ev="+e+"&pt="+t;return i&&(n+="&ft="+i),n}return"v=3&pt="+t},e.prototype._onStart=function(){this._pingServer&&!this._sentStartPing&&(this._sendPing(this.START,0),this._sentStartPing=!0)},e.prototype._onSeeking=function(){this._seeking=!0,this._nextTime=void 0,this._seekFromTime=this._currentTime},e.prototype._onSeeked=function(){this._pingServer&&this._seeking&&this._seekFromTime&&(this._sendPing(this.SEEK,this._currentTime,this._seekFromTime),this._seeking=!1,this._seekFromTime=void 0)},e.prototype._onPlayerPositionChanged=function(){this._currentTime=this._video.currentTime,this._pingServer&&!this._seeking&&this._nextTime&&this._currentTime>this._nextTime&&(this._nextTime=void 0,this._sendPing(null,this._currentTime))},e.prototype._sendPing=function(e,t,i){var n=this,r=this._protocol+"//"+this._domain+"/session/ping/"+this._sessionId+".json?"+this._createQueryString(e,t,i),o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="text",o.onload=function(){if(200===o.status){var e=JSON.parse(o.responseText);n._nextTime=e.next_time,(n._nextTime<0||e.hasOwnProperty("error"))&&(n._pingServer=!1,n._nextTime=void 0,n._video.removeEventListener("timeupdate",n._onPlayerPositionChanged),n._video.removeEventListener("playing",n._onStart),n._video.removeEventListener("seeked",n._onSeeked),n._video.removeEventListener("seeking",n._onSeeking))}},o.send()},e}();i.PingService=n},{}]},{},[12]);